<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Share - Upload</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-2xl w-full bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Share Your Files</h1>
                <p class="text-gray-600 mt-2">Upload multiple files and get a shareable link</p>
            </div>

            <div class="mb-8">
                <div class="relative border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors" 
                     id="drop-zone"
                     ondrop="handleDrop(event)"
                     ondragover="handleDragOver(event)"
                     onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" multiple class="hidden" onchange="handleFiles(this.files)">
                    <div class="space-y-4">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M24 32V16m0 0l-8 8m8-8l8 8M6 40h36a2 2 0 002-2V10a2 2 0 00-2-2H6a2 2 0 00-2 2v28a2 2 0 002 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div>
                            <p class="text-gray-600">Drag and drop your files here, or click to select</p>
                            <p class="text-sm text-gray-500 mt-1">Upload multiple files at once</p>
                        </div>
                    </div>
                </div>
                <div id="file-list" class="mt-4 space-y-2"></div>
            </div>

            <div id="upload-status" class="hidden mb-6">
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="upload-progress" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
                <p id="upload-text" class="text-sm text-gray-600 mt-2 text-center"></p>
            </div>

            <div id="share-section" class="hidden">
                <div class="flex items-center space-x-4 bg-gray-50 p-4 rounded-lg">
                    <input type="text" id="share-url" readonly class="flex-1 p-2 border rounded bg-white" value="">
                    <button onclick="copyShareLink()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Copy Link
                    </button>
                </div>
            </div>

            <button onclick="uploadFiles()" id="upload-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors mt-4">
                Upload Files
            </button>
        </div>
    </div>

    <script>
        let selectedFiles = [];

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const newFiles = Array.from(e.dataTransfer.files);
            selectedFiles = [...selectedFiles, ...newFiles];
            updateFileList();
        }

        function handleFiles(files) {
            const newFiles = Array.from(files);
            selectedFiles = [...selectedFiles, ...newFiles];
            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded">
                    <div class="flex items-center space-x-3">
                        <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span class="text-sm text-gray-700">${file.name}</span>
                    </div>
                    <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        function uploadFiles() {
            if (selectedFiles.length === 0) {
                alert('Please select files to upload');
                return;
            }

            const formData = new FormData();
            selectedFiles.forEach(file => {
                formData.append('files', file);
            });

            const uploadStatus = document.getElementById('upload-status');
            const uploadProgress = document.getElementById('upload-progress');
            const uploadText = document.getElementById('upload-text');
            const uploadBtn = document.getElementById('upload-btn');
            
            uploadStatus.classList.remove('hidden');
            uploadBtn.disabled = true;
            uploadBtn.classList.add('opacity-50');

            axios.post('/api/upload/', formData, {
                headers: {
                    'Content-Type': 'multipart/form-data'
                },
                onUploadProgress: (progressEvent) => {
                    const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);
                    uploadProgress.style.width = percentCompleted + '%';
                    uploadText.textContent = `Uploading... ${percentCompleted}%`;
                }
            })
            .then(response => {
                if (response.data.status === 200) {
                    const shareUrl = `${window.location.origin}/download/${response.data.data.folder}/`;
                    document.getElementById('share-url').value = shareUrl;
                    document.getElementById('share-section').classList.remove('hidden');
                    uploadText.textContent = 'Upload complete!';
                    uploadText.classList.add('text-green-600');
                    // Clear selected files after successful upload
                    selectedFiles = [];
                    updateFileList();
                }
            })
            .catch(error => {
                uploadText.textContent = 'Upload failed. Please try again.';
                uploadText.classList.add('text-red-600');
                uploadBtn.disabled = false;
                uploadBtn.classList.remove('opacity-50');
            });
        }

        function copyShareLink() {
            const shareUrl = document.getElementById('share-url');
            shareUrl.select();
            document.execCommand('copy');
            
            const copyBtn = event.target;
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Copied!';
            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 2000);
        }
    </script>
</body>
</html>